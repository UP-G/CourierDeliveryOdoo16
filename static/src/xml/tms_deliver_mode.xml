<?xml version="1.0" encoding="UTF-8" ?>
<template xml:space="preserve">

<!-- Base templates. Структуру не менять (Разве что в TmsMessage можно подключить другие шаблоны или разделить их)  -->

    <t t-name="TmsBase">
        <t t-call="TmsMessage"/>
        <t t-call="TmsContent"/>
		<t t-call="TmsButtons"/>
    </t>

    <t t-name="TmsMessage">
        <t t-call="TmsMessageSmth"/>
    </t>

    <t t-name="TmsButtons">
        <t t-if="Object.keys(context.concretePoint.point).length != 0" t-call="TmsPointButtons"/>

        <t t-elif="context.routePoints.points.length" t-call="TmsRoutePointsButtons"/>

        <t t-elif="context.routes.length >= 0" t-call="TmsRouteButtons"/>
    </t>

    <t t-name="TmsContent">

        <t t-if="Object.keys(context.concretePoint.point).length != 0" t-call="TmsPoint"/>

        <t t-elif="context.routePoints.points.length" t-call="TmsRoutePoints"/>

        <t t-elif="context.routes.length >= 0" t-call="TmsRoute"/>

    </t>

<!--  Data and card templates   -->

    <t t-name="TmsRoute">
        <div class="container">
            <div class="o_tms_card-group hepler">
                <div t-if="context.attendance.check_out == null">
                    For this user, an employee is not created. Please contact your manager
                </div>
                <div t-elif="!context.attendance.check_out">
                    Click "Start shift" to display orders
                </div>
                <div t-elif="context.attendance.check_out and context.routes.length == 0">
                    No route sheets
                </div>
                <div t-elif="context.attendance.check_out and context.routes.length >= 0">
                    Select Work Order to display delivery points
                </div>
            </div>
            <div class="card-group route" t-if="context.attendance.check_out">
            <t t-foreach="context.routes" t-as="route" t-key="route.id">
                <div t-attf-class="card route bg-{{ route.departed_on_route ?
                (route.finished_the_route ? (!route.returned_to_the_store ? 'warning' : 'black') : 'success')
                : 'white' }}">
                    <a href="#">
                        <div t-attf-id="{{route.id}}" t-attf-class="card-body route points {{route.name}}">
                            <h3 data-name="name" class="card-title route" t-esc="route.name"></h3>
                            <p data-name="id" style="display: none;" t-esc="route.id"></p>
                            <div class="card-description route">
                                <p class="o_tms_card-text route" t-if="route.start_time" t-esc="'Date start: ' + route.start_time"></p>
                                <p t-if="!route.start_time">No start time for the route</p>
                                <p class="o_tms_card-text route" t-if="route.end_time" t-esc="'Date end: ' + route.end_time"></p>
                                <p t-if="!route.end_time">No end time for the route</p>
                            </div>
                            <div class="card-driver route">
                                <p class="mb-1" t-if="route.driver_id" t-esc="route.driver_name"></p>
                                <p t-if="!route.driver_id">Not assigned</p>
                            </div>
                        </div>
                    </a>
                </div>
                </t>
            </div>
        </div>
    </t>

    <t t-name="TmsRoutePoints">
        <div class="container">
            <div class="card-header">
                <h2 class="card-title" title="Points of the route">Points of the route " <t t-esc="context.routePoints.routeName"></t></h2>
            </div>

            <div class="card-group point-route" >
                <t t-foreach="context.routePoints.points" t-as="point" t-key="point.id">
                <div t-attf-class="card point-route bg-{{ point.delivered or point.returned_client ? 'black' :
                (context.routePoints.departedOnRoute ?
                (context.routePoints.finishedTheRoute ? (!context.routePoints.returnedToTheStore ? 'warning' : 'black') : 'success')
                : 'white') }}">
                    <a href="#">
                        <div class="card-body point-route o_tms_concrete-point-event" t-attf-id="{{point.id}}">
                            <div class="tms-card-header">
                                <h5 class="card-title point-route" t-esc="point.impl_num"></h5>
                                <h5 data-name="name" style="display: none;" class="card-title point-route" t-esc="point.order_num"></h5>
                            </div>
                            <p data-name="id" style="display: none;" t-esc="point.id"></p>
                            <div class="o_tms_card-street point-route" t-esc="point.street" t-if="point.street"></div>
                            <div class="card-description point-route">
                                <p class="o_tms_card-text point-route"><t t-esc="point.company_name" t-if="point.company_name"></t></p>
                                <p class="o_tms_card-text point-route"><t t-esc="point.phone" t-if="point.phone"></t></p>
                                <p class="o_tms_card-text point-route"><t t-esc="point.note" t-if="point.note"></t></p>
                            </div>
                        </div>
                    </a>
                </div>
                </t>
            </div>
        </div>
    </t>

    <t t-name="TmsPoint">
        <div class="container cdf">
            <div class="card mt-2">
                <div class="card-header">
                    <h2 class="card-title" title="Information about the order ">Information about the order <t t-esc="context.concretePoint.pointOrderName"></t></h2>
                </div>
                <div class="card">
                    <div class="card-body">
                        <table class="table table-bordered">
                             <!-- <tr>
                                <th title="Implemention number">Implemention number</th>
                                <td><t t-esc="context.concretePoint.point.impl_num" t-if="context.concretePoint.point.impl_num"></t></td>
                            </tr> -->
                            <tr>
                                <th title="Delivery Address" scope="row">Delivery Address</th>
                                <td><t t-esc="context.concretePoint.deliveryAddress" t-if="context.concretePoint.deliveryAddress"></t></td>
                            </tr>
                            <tr>
                                <th title="Phone" scope="row">Phone</th>
                                <td><t t-esc="context.concretePoint.phone" t-if="context.concretePoint.phone"></t></td>
                            </tr>
                            <tr>
                                <th title="Note" scope="row">Note</th>
                                <td><t t-esc="context.concretePoint.point.note" t-if="context.concretePoint.point.note"></t></td>
                            </tr>
                            <tr style='display: none;'>
                                <th title="Date arrival" 
                                scope="row"
                                >Date arrival</th>
                                <td><t t-esc="context.concretePoint.point.arrival_date" t-if="context.concretePoint.point.arrival_date"></t></td>
                            </tr>
                            <tr t-if="context.concretePoint.point.impl_num.includes('Возврат')">
                                <th title="Date return from client" scope="row">Date return from client</th>
                                <td><t t-esc="context.concretePoint.point.returned_client" t-if="context.concretePoint.point.returned_client"></t></td>
                            </tr>
                            <tr style="display: none">
                                <th title="Date return from store" scope="row">Date return from store</th>
                                <td><t t-esc="context.concretePoint.point.returned_store" t-if="context.concretePoint.point.returned_store"></t></td>
                            </tr>
                            <tr t-if="!context.concretePoint.point.impl_num.includes('Возврат')">
                                <th title="Date deliver" scope="row">Date deliver</th>
                                <td><t t-esc="context.concretePoint.point.delivered" t-if="context.concretePoint.point.delivered"></t></td>
                            </tr>
                            <tr style="display: none">
                                <th title="Date claim" scope="row">Date claim</th>
                                <td><t t-esc="context.concretePoint.point.complaint" t-if="context.concretePoint.point.complaint"></t></td>
                            </tr>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </t>

    <!--  Buttons templates   -->

    <t t-name="TmsRouteButtons">
        <div class="o_tms_action_start">
            <button t-attf-class="o_tms_attendance_sign btn btn-{{ context.attendance.check_out ? 'warning' : 'success' }} align-self-center px-5 py-3 mt-4 mb-2 {{ context.attendance.check_out == null ? 'disabled' : '' }}">
                <span class="align-middle fs-2 text-white" t-if="!context.attendance.check_out">Start shift</span>
                <i t-attf-class="fa fa-4x fa-sign-{{ context.attendance.check_out ? 'out' : 'in' }} align-middle"/>
                <span class="align-middle fs-2" t-if="context.attendance.check_out">Stop shift</span>
            </button>
            <button type="button" class="o_tms_update_routes event btn btn-primary">
            <i class='fa fa-refresh'></i>
        </button>
        </div>
        <p class='text-center' t-if="!context.attendance.check_out and context.attendance.hours_today" 
            t-esc="'Number of hours worked during the current shift: ' + context.attendance.hours_today"></p>
    </t>

    <t t-name="TmsRoutePointsButtons">
            <div class="d-flex justify-content-center">
                <div class="o_tms_action_nav" style="width: 100%;">
                    <button
                    type="button"
                            t-attf-class="o_tms_btn_RouteList btn btn-lg btn-block btn-secondary border">
                            <i class='fa fa-mail-reply'></i>
							<p>Routes list</p></button>
                    <button
                    type="button"
                            t-attf-class="o_tms_btn_Departed btn btn-lg btn-block btn-{{context.routePoints.departedOnRoute ? ' disabled' : 'primary'}} border"
							><i class='fa fa-truck'></i>
							<p>Departed on route</p></button>
                    <button
                    type="button"
                            t-attf-class="o_tms_btn_Finished_Route btn btn-lg btn-block btn-{{ !context.routePoints.departedOnRoute ? 
                            ' disabled' : (!context.routePoints.finishedTheRoute and context.routePoints.checkAllFinishOrder ? 'primary' : ' disabled')}} border">
                            <i class='fa fa-check-square-o'></i>
							<p>Finished the route</p></button>
                    <button
                    type="button"
                            t-attf-class="o_tms_btn_Returned_Store btn btn-lg btn-block btn-{{!context.routePoints.returnedToTheStore and context.routePoints.finishedTheRoute  ? 'primary' : ' disabled'}} border">
                            <i class='fa fa-home'></i>
							<p>Returned to the store</p></button>
                </div>
            </div>
    </t>

    <t t-name="TmsPointButtons">
        <div class="d-flex justify-content-center">
                <div class="o_tms_action_nav" style="width: 100%;">
				    <button
                            class="o_tms_btn_PointList btn btn-lg btn-block btn-secondary border"> 
							<i class='fa fa-mail-reply'></i><p>Points list</p></button>
                    <button title="Arrival"
                            class="o_tms_btn_Arrival btn btn-lg btn-block btn-secondary border"
                            style='display: none;'>
							<i class='fa fa-clock-o'></i><p>Arrival</p></button>
                    <button title="Return from client"
                            t-attf-class="o_tms_btn_Returned btn btn-lg btn-block btn-{{ context.concretePoint.point.impl_num.includes('Возврат') and context.concretePoint.point.returned_client == false
                            ? 'primary' : ' disabled'}} border">
							<i class='fa fa-shopping-cart'></i><p>Return from client</p></button>

                    <button title="Delivered to client"
                            t-attf-class="o_tms_btn_Delivered btn btn-lg btn-block btn-{{ !context.concretePoint.point.impl_num.includes('Возврат') and context.concretePoint.point.delivered == false
                             ? 'primary' : ' disabled'}} border">
							<i class='fa fa-cubes'></i><p>Delivered to client</p></button>

                    <button title="No claims"
                            class="o_tms_btn_Claims btn btn-lg btn-block btn-secondary border"
                            style="display: none;"> 
							<i class='fa fa-warning'></i><p>No claims</p></button>
                </div>
        </div>
    </t>

<!--  Message templates  -->

    <t t-name="TmsMessageSmth" style='display: none'>
        <t t-if="true">
            <div id="myModal" class="modal" style='display: none'>

            <!-- Modal content -->
            <div class="modal-content">
                <div class="modal-header">
                <span class="close">&times;</span>
                <h2>Modal Header</h2>
                </div>
                <div class="modal-body">
                <p>Some text in the Modal Body</p>
                <p>Some other text...</p>
                </div>
                <div class="modal-footer">
                <button>Ok</button>
                </div>
            </div>

            </div>
        </t>
    </t>

</template>